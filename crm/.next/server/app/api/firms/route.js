"use strict";(()=>{var e={};e.id=7878,e.ids=[7878],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1143:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y});var a={};t.r(a),t.d(a,{GET:()=>l,POST:()=>p});var i=t(9303),n=t(8716),o=t(670),s=t(7070),d=t(9487);let c="http://45.92.173.121/api".replace("/api","")||0;function u(e){var r;let t="DRAFT";return e.status?t=e.status:!0===e.isActive?t="ACTIVE":!1===e.isActive&&(t="DRAFT"),{id:e.id,name:e.name,city:e.city||"",status:t,isVisibleInClientApp:e.isVisibleInClientApp??"ACTIVE"===t,logoUrl:(r=e.logoUrl)?r.startsWith("http")?r:`${c}${r}`:null,rating:parseFloat(e.rating)||5,deliveryTime:e.deliveryTime,minOrder:e.minOrder,deliveryFee:e.deliveryFee,clientsCount:e._count?.clients||0,ordersCount:e._count?.orders||0,driversCount:e._count?.drivers||0,createdAt:e.createdAt,submittedAt:e.submittedAt,approvedAt:e.approvedAt,rejectionReason:e.rejectionReason,bottleDepositEnabled:e.bottleDepositEnabled??!1,bottleDepositPrice:e.bottleDepositPrice??15e3}}async function l(){try{let{data:e,error:r}=await d.db.getFirms();if(r)throw r;let t=Array.isArray(e)?e.map(u):[];return s.NextResponse.json({firms:t},{status:200})}catch(e){return console.error("Error fetching firms:",e),s.NextResponse.json({error:e.message||"Failed to fetch firms"},{status:500})}}async function p(e){try{let{name:r,city:t,logoUrl:a,ownerName:i,ownerEmail:n,ownerPhone:o,ownerPassword:c}=await e.json();if(!r||!t)return s.NextResponse.json({error:"Name and city are required"},{status:400});let{data:u,error:l}=await d.db.createFirm({name:r,city:t,logoUrl:a,status:"DRAFT",isVisibleInClientApp:!1,clients_count:0,orders_count:0,drivers_count:0});if(l)throw l;return s.NextResponse.json({firm:u,message:"Firm created in draft mode. Owner can login to complete setup."},{status:201})}catch(e){return console.error("Error creating firm:",e),s.NextResponse.json({error:e.message||"Failed to create firm"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/firms/route",pathname:"/api/firms",filename:"route",bundlePath:"app/api/firms/route"},resolvedPagePath:"/Users/musabekisakov/claudeCode/crm/app/api/firms/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:v}=m,g="/api/firms/route";function f(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},9487:(e,r,t)=>{async function a(e,r={},t){try{let a=t||null,i={"Content-Type":"application/json",...r.headers};a&&(i.Authorization=`Bearer ${a}`);let n=await fetch(`http://45.92.173.121/api${e}`,{...r,headers:i}),o=await n.json();if(!n.ok||!o.success)return{data:null,error:Error(o.error?.message||o.message||"Request failed")};return{data:o.data,error:null}}catch(e){return{data:null,error:e}}}t.d(r,{Z:()=>n,db:()=>i});let i={getFirms:async()=>a("/firms"),getFirmById:async e=>a(`/firms/${e}`),createFirm:async e=>a("/firms",{method:"POST",body:JSON.stringify(e)}),updateFirm:async(e,r,t)=>a(`/firms/${e}`,{method:"PUT",body:JSON.stringify(r)},t?.authToken),deleteFirm:async(e,r)=>a(`/firms/${e}`,{method:"DELETE"},r?.authToken),async getProducts(e){let r=e?`?firmId=${e}`:"";return a(`/products${r}`)},createProduct:async(e,r)=>a("/products",{method:"POST",body:JSON.stringify({firmId:e.firm_id,name:e.name,description:e.description,price:e.price,imageUrl:e.image_url,volume:e.volume,inStock:e.in_stock})},r?.authToken),async updateProduct(e,r,t){let i={};return void 0!==r.name&&(i.name=r.name),void 0!==r.description&&(i.description=r.description),void 0!==r.price&&(i.price=r.price),void 0!==r.image_url&&(i.imageUrl=r.image_url),void 0!==r.volume&&(i.volume=r.volume),void 0!==r.in_stock&&(i.inStock=r.in_stock),a(`/products/${e}`,{method:"PUT",body:JSON.stringify(i)},t?.authToken)},deleteProduct:async(e,r)=>a(`/products/${e}`,{method:"DELETE"},r?.authToken),async getOrders(e,r,t){let i=new URLSearchParams;e&&i.append("firmId",e),r&&i.append("branchId",r),t&&i.append("canAccessAllBranches","true");let n=i.toString()?`?${i.toString()}`:"";return a(`/orders${n}`)},getOrderById:async e=>a(`/orders/${e}`),updateOrderStatus:async(e,r)=>a(`/orders/${e}/status`,{method:"PUT",body:JSON.stringify({stage:r})}),createOrder:async e=>a("/orders",{method:"POST",body:JSON.stringify(e)}),async getDrivers(e,r,t,i){let n=new URLSearchParams;e&&n.append("firmId",e),r&&n.append("branchId",r),t&&n.append("canAccessAllBranches","true");let o=n.toString()?`?${n.toString()}`:"";return a(`/drivers${o}`,{},i?.authToken)},getDriverById:async e=>a(`/drivers/${e}`),createDriver:async(e,r)=>a("/drivers",{method:"POST",body:JSON.stringify({firmId:e.firmId,name:e.name,phone:e.phone,vehicleNumber:e.car_plate,carBrand:e.car_brand,carColor:e.car_color,driverNumber:e.driver_number?.toString()||"0"})},r?.authToken),async updateDriver(e,r,t){let i={};return void 0!==r.name&&(i.name=r.name),void 0!==r.phone&&(i.phone=r.phone),void 0!==r.car_plate&&(i.vehicleNumber=r.car_plate),void 0!==r.car_brand&&(i.carBrand=r.car_brand),void 0!==r.car_color&&(i.carColor=r.car_color),void 0!==r.is_available&&(i.isAvailable=r.is_available),a(`/drivers/${e}`,{method:"PUT",body:JSON.stringify(i)},t?.authToken)},deleteDriver:async(e,r)=>a(`/drivers/${e}`,{method:"DELETE"},r?.authToken),async getClients(e,r,t,i){let n=new URLSearchParams;e&&n.append("firmId",e),r&&n.append("branchId",r),t&&n.append("canAccessAllBranches","true");let o=n.toString()?`?${n.toString()}`:"";return a(`/clients${o}`,{},i?.authToken)},async getClientById(e,r,t){let i=new URLSearchParams;r&&i.append("firmId",r);let n=i.toString()?`?${i.toString()}`:"";return a(`/clients/${e}${n}`,{},t?.authToken)},deleteClient:async(e,r)=>a(`/clients/${e}`,{method:"DELETE"},r?.authToken)},n=i}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[9276,5972],()=>t(1143));module.exports=a})();